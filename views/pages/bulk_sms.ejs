<div class="row">
    <div class="col-lg-12">
        <div class="card m-b-20">
            <div class="card-body">
                <form id="send_bulk_sms">
                    <div class="form-group row">
                        <label for="campaign_name_input" class="col-sm-3 col-form-label">Campaign Name</label>
                        <div class="col-sm-9">
                            <input class="form-control" type="text" required placeholder="Campaign Name" id="campaign_name_input" name="campaignName">
                        </div>
                    </div>
                    <div class="form-group row">
                        <label class="col-sm-3 col-form-label">Sender ID</label>
                        <div class="col-sm-9">
                            <select Id="sende_id" class="form-control select2" name="sendId">
                                <option value="" selected>Open this select menu</option>
                                <option value="1">One</option>
                                <option value="2">Two</option>
                                <option value="3">Three</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-group row">
                        <label class="col-sm-3 col-form-label">Message Type</label>
                        <div class="col-sm-9">
                            <div class="form-group row">
                                <div class="col-sm-6">
                                    <select id="mess_type" class="form-control select2">
                                        <option value="english" selected>English</option>
                                        <option value="1">Unicode</option>
                                    </select>
                                </div>
                                <div class="col-sm-6">
                                    <div class="row">
                                        <label class="col-sm-4 col-form-label">Send As</label>
                                        <div class="col-sm-8">
                                            <select id="mess_send_as" class="form-control select2">
                                                <option value="normal" selected>Normal</option>
                                                <option value="flash">Flash</option>
                                            </select>
                                        </div>
                                    </div>
                                </div>
                            </div>

                        </div>
                    </div>
                    <div class="form-group row">
                        <label for="bulk_sms_txtarea" class="col-sm-3 col-form-label">Compose</label>
                        <div class="col-sm-9">
                            <textarea id="bulk_sms_txtarea" class="form-control" maxlength="2000" rows="3" placeholder="Type Message" name="msgCompose"></textarea>
                            <p></p>
                            <button type="button" class="btn btn-primary waves-effect waves-light" data-toggle="modal" data-target="">Save as Template</button><input type="text" placeholder="Message Count" id="mess_count">
                        </div>
                    </div>
                    <div class="form-group row">
                        <label for="textarea" class="col-sm-3 col-form-label">Mobile Numbers</label>
                        <div class="col-sm-9">
                            <textarea id="textarea" class="form-control" maxlength="100000" rows="3" placeholder="Paste Mobile numbers with comma separated" name="mobNumbers"></textarea>
                        </div>
                    </div>

                    <div class="form-group row">
                        <label class="col-sm-3 col-form-label">Upload Mobile Numbers</label>
                        <div class="col-sm-9">
                            <input type="file" id="file_upload" class="filestyle" data-buttonname="btn-secondary">
                        </div>
                    </div>
                    <div class="form-group row">
                        <label class="col-sm-3 col-form-label">Remove Duplicates</label>
                        <div class="col-sm-9">
                            <input type="checkbox" id="remove_dupl" switch="none" checked />
                            <label for="remove_dupl" data-on-label="Yes" data-off-label="No"></label>
                        </div>
                    </div>
                    <div class="form-group row">
                        <label class="col-sm-3 col-form-label">Schedule Message </label>
                        <div class="col-sm-9">
                            <select id="sched_msg" class="form-control select2">
                                <option value="no_segment" selected>No</option>
                                <option value="yes_segment">Yes</option>
                                <option value="segmented">Segmented</option>
                            </select>
                        </div>
                    </div>

                    <div id="sched_date_time" class="form-group row" style="display:none;">
                        <label class="col-sm-3 col-form-label"></label>
                        <div class="col-sm-9">
                            <div class="row">
                                <div class="start-date col-sm-4">
                                    <label class="col-form-label">Start Date</label>
                                    <div class="input-group">
                                        <input type="text" class="form-control" placeholder="mm/dd/yyyy" id="datepicker-autoclose">
                                        <div class="input-group-append">
                                            <span class="input-group-text"><i class="mdi mdi-calendar"></i></span>
                                        </div>
                                    </div>
                                </div>
                                <div class="start-time col-sm-3" style="padding-right: 10px;padding-left: 10px;">
                                    <label class="col-form-label">Start Time</label>
                                    <div class="row">
                                        <div class="col-sm-6" style="padding-right: 3px;padding-left: 3px;">
                                            <select id="sch_hours" class="form-control select2">
                                                <option selected>Hour</option>
                                            </select>
                                        </div>
                                        <div class="col-sm-6" style="padding-right: 3px;padding-left: 3px;">
                                            <select id="sch_minutes" class="form-control select2">
                                                <option selected>Minutes</option>
                                            </select>
                                        </div>
                                    </div>
                                </div>
                                <div class="send-interval col-sm-2">
                                    <label class="col-form-label">Interval</label>
                                    <input class="form-control" type="text" required placeholder="" id="interval">
                                </div>
                                <div class="vol-interval  col-sm-3">
                                    <label class="col-form-label">Volume/interval</label><input class="form-control" type="text" required placeholder="" id="vol_per_interval">
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="form-group row">
                        <label class="col-sm-3 col-form-label">Include Test Numbers</label>
                        <div class="col-sm-9">
                            <input type="checkbox" id="incl_test_num" checked switch="none" checked />
                            <label for="incl_test_num" data-on-label="Yes" data-off-label="No"></label>
                        </div>
                    </div>
                    <div class="form-group row">
                        <label class="col-sm-3 col-form-label">Test Before Sending</label>
                        <div class="col-sm-9">
                            <div>
                                <!-- Small modal -->
                                <button id="btn_test_msg" type="button" class="btn btn-primary waves-effect waves-light">Click to open test..</button>
                                <!-- <button id="btn_test_msg" type="button" class="btn btn-primary waves-effect waves-light" data-toggle="modal" data-target=".bs-example-modal-center">Click to open test..</button> -->
                            </div>

                            <div id="modalTestsend" class="modal fade bs-example-modal-center" tabindex="-1" role="dialog" aria-labelledby="mySmallModalLabel" aria-hidden="true">
                                <div class="modal-dialog modal-dialog-centered">
                                    <div class="modal-content">
                                        <div class="modal-header">
                                            <h5 class="modal-title mt-0">Test before Sending</h5>
                                            <button type="button" class="close" data-dismiss="modal" aria-hidden="true">Ã—</button>
                                        </div>
                                        <div class="modal-body">
                                            <div class="form-group row">
                                                <label for="campaign_name_input" class="col-sm-4 col-form-label">Message</label>
                                                <div class="col-sm-8">
                                                    <textarea id="txt_test_msg" class="form-control" rows="3" placeholder="Type Message"></textarea>
                                                </div>
                                            </div>
                                            <div class="form-group row">
                                                <label class="col-sm-3 col-form-label">Test Numbers</label>
                                                <div class="col-sm-9">
                                                    <select Id="test_nums" class="form-control select2" name="sendId">
                                                        <option value="" selected>Open this select menu</option>
                                                        <option value="1">9999999999</option>
                                                        <option value="2">8888888888</option>
                                                        <option value="3">7777777777</option>
                                                    </select>
                                                </div>
                                            </div>
                                            <!-- <div class="form-group row">
                                                <label class="col-sm-4 col-form-label">Include Test Numbers</label>
                                                <div class="col-sm-8">
                                                    <input type="checkbox" id="switch4" checked switch="none" checked/>
                                                            <label for="switch4" data-on-label="Yes"
                                                                   data-off-label="No"></label>
                                                </div>                        
                                            </div> -->
                                            <div class="modal-footer">
                                                <button type="button" class="btn btn-secondary waves-effect" data-dismiss="modal">Close</button>
                                                <button type="button" class="btn btn-primary waves-effect waves-light">Test</button>
                                            </div>
                                        </div>
                                    </div><!-- /.modal-content -->
                                </div><!-- /.modal-dialog -->
                            </div><!-- /.modal -->
                        </div>
                    </div>
                    <div class="form-group row">
                        <label class="col-sm-3 col-form-label"></label>
                        <div class="col-sm-9">
                            <button id="btn_send_bulk_sms" type="submit" class="btn btn-success waves-effect waves-light">
                                Send
                            </button>
                            <button type="reset" class="btn btn-secondary waves-effect m-l-5">
                                Cancel
                            </button>
                        </div>

                        <div id="mod_send_conf_msg" class="modal fade bs-example-modal-center" tabindex="-1" role="dialog" aria-labelledby="mySmallModalLabel" aria-hidden="true">
                            <div class="modal-dialog modal-dialog-centered">
                                <div class="modal-content">
                                    <div class="modal-header">
                                        <h5 class="modal-title mt-0">Are you sure to send following details</h5>
                                        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">Ã—</button>
                                    </div>
                                    <div class="modal-body">
                                    <div class="card m-b-20">
                                    <div class="card-body" id="conf_card_body">
                                        <div class="form-group row">
                                            <label for="conf_camp_name" class="col-sm-3 col-form-label">Campaign Name :</label>
                                            <div class="col-sm-9">
                                                <label id="conf_camp_name" name="confCampName"></label>
                                            </div>
                                        </div>
                                        <div class="form-group row">
                                            <label for="conf_camp_name" class="col-sm-3 col-form-label">Sender Id :</label>
                                            <div class="col-sm-9">
                                                <label id="conf_send_id" name="senderId"></label>
                                            </div>
                                        </div>
                                        <div class="form-group row">
                                            <label for="conf_camp_name" class="col-sm-3 col-form-label">Message Type :</label>
                                            <div class="col-sm-9">
                                                <label id="conf_mess_type"></label>
                                            </div>
                                        </div>
                                        <div class="form-group row">
                                            <label for="conf_camp_name" class="col-sm-3 col-form-label">Send As :</label>
                                            <div class="col-sm-9">
                                                <label id="conf_send_as"></label>
                                            </div>
                                        </div>
                                        <div class="form-group row">
                                            <label for="conf_camp_name" class="col-sm-3 col-form-label">Schedule Message :</label>
                                            <div class="col-sm-9">
                                                <label id="conf_sch_mess"><label>
                                            </div>
                                        </div>
                                        <div class="form-group row">
                                            <label for="campaign_name_input" class="col-sm-3 col-form-label">Message :</label>
                                            <div class="col-sm-9">
                                                <label id="txtar_fin_conf_sms"></label>
                                            </div>
                                        </div>
                                        <div class="form-group row">
                                            <label for="campaign_name_input" class="col-sm-3 col-form-label">Cost :</label>
                                            <div class="col-sm-9">
                                                <label id="total_cost"></label>
                                            </div>
                                        </div>
                                        <div class="modal-footer">
                                            <button type="button" class="btn btn-secondary waves-effect" data-dismiss="modal">Cancel</button>
                                            <button id="btn_conf_yes" type="button" class="btn btn-primary waves-effect waves-light">Yes</button>
                                        </div>
                                        </div>
                                        </div>
                                    </div>
                                </div><!-- /.modal-content -->
                            </div><!-- /.modal-dialog -->
                        </div><!-- /.modal -->

                    </div>
                </form>

            </div>
        </div>
    </div> <!-- end col -->
</div> <!-- end row -->
<style type="text/css">
#txtar_fin_conf_sms{
    pointer-events:none;
    opacity: 0.8;
}
#mod_send_conf_msg{
    width: 100% !important;
    padding: 0px !important;
    height: 100% !important;
    overflow: hidden !important;
}
#mod_send_conf_msg .modal-dialog{
    width: 100% !important;
    max-width: 100% !important;
    height: 100% !important;
    margin: 0 auto !important;
   /* margin: 0 !important;*/  
}
#mod_send_conf_msg .modal-content{
    height: 100% !important; 
    border: 0px !important;
    border-radius: 0px !important;
}
#mod_send_conf_msg input ,#txtar_fin_conf_sms{
    border: 0px;
    padding: 4px 1px 1px 1px;
    pointer-events: none;
    font-size: 16px;
    color: #6b6b6b;
}
#mod_send_conf_msg .card{
    border: 1px solid #e7e7e7;
}
#conf_card_body .form-group{
    margin-bottom: 0px !important;
}
#conf_card_body > .form-group:nth-of-type(odd){
    background: #f8f8f8;
}
#conf_card_body > .form-group:nth-of-type(odd) input{
    background: #f8f8f8;
}
/*#mod_send_conf_msg .modal-content{
     height: 100% !important;
}*/
</style>
<script src="pages/cust_js/send_sms.js"></script>
<script type="text/javascript">
    $(document).ready(function() {
        // $('form').parsley();
        $("#page_title").html(<%- JSON.stringify(title) %>);

        for(var i=0; i<=24; i++){
                if(i<10){
                    i="0"+i;
                }
                $("#sch_hours").append("<option val='"+i+"'>"+i+"</option>");
            }
        for(var i=0; i<=60; i++){
            if(i<10){
                i="0"+i;
                }
            $("#sch_minutes").append("<option val='"+i+"'>"+i+"</option>");
        }

    var uniq_camp_id = formObject.gencampname();
    console.log(uniq_camp_id.uniqCampID);
    $("#campaign_name_input").val(uniq_camp_id.uniqCampID);

$('#bulk_sms_txtarea').keyup(function() {
    
  var characterCount = $(this).val().length,
      current = $('#current'),
      maximum = $('#maximum'),
      theCount = $('#the-count');
     current.text(characterCount);
  
  /* ===| This isn't entirely necessary, just playin around |=== */
  if (characterCount < 70) {
    let messCnt = 1;
    $("#mess_count").val(messCnt);

  }
  if (characterCount > 70 && characterCount < 140) {
    let messCnt = 2;
    $("#mess_count").val(messCnt);
  }
  if (characterCount > 140 && characterCount < 210) {
    let messCnt = 3;
    $("#mess_count").val(messCnt);
  }
  if (characterCount > 210 && characterCount < 280) {
    let messCnt = 4;
    $("#mess_count").val(messCnt);
  }
  if (characterCount > 280 && characterCount < 350) {
    let messCnt = 5;
    $("#mess_count").val(messCnt);
  }
      
});

        $('#send_bulk_sms').formValidation({
                framework: 'bootstrap',
                icon: {
                    valid: 'glyphicon glyphicon-ok',
                    invalid: 'glyphicon glyphicon-remove',
                    validating: 'glyphicon glyphicon-refresh'
                },
                fields: {
                    campaignName: {
                        validators: {
                            notEmpty: {
                                message: 'Enter campaign Name'
                            }
                        }
                    },
                    sendId: {
                        validators: {
                            notEmpty: {
                                message: 'Select sender Id'
                            }
                        }
                    },
                    msgCompose: {
                        validators: {
                            notEmpty: {
                                message: 'Enter message'
                            }
                        }
                    },
                    mobNumbers: {
                        validators: {
                            notEmpty: {
                                message: 'Enter mobile number'
                            },
                            regexp: {
                            regexp: /^[0-9\s]*$/,
                            message: 'Only digits and space allowed'
                            }
                        }
                    }
                }
            })
            .on('success.form.fv', function(e) {
                //return formValid;
                e.preventDefault();
                //Ajax Call Here
            });
        /*$("#btn_test_msg").click(function(){
            $('#send_bulk_sms')).data('formValidation').validate();
        });*/
        $("#btn_test_msg").on("click", function(e) {
            var isformValid = $('#send_bulk_sms').data('formValidation').validate();
            console.log(isformValid["$invalidFields"].length);
            if (isformValid["$invalidFields"].length <= 0) {
                var sms_to_send = $("#bulk_sms_txtarea").val();
                $("#txt_test_msg").html(sms_to_send);
                $('#modalTestsend').modal('show');
            } else if (isformValid["$invalidFields"].length > 0) {
                $('#modalTestsend').modal('hide');
            }
            $('#btn_send_bulk_sms').prop('disabled', false);
            $('#btn_send_bulk_sms').removeAttr("disabled");
            e.preventDefault();
            /*if(formValid == true){
                $('#modalTestsend').modal('show'); 
            }else{
                $('#modalTestsend').modal('hide'); 
            }*/
        });

        $("#sched_msg").on("change", function() {
            var schedMessage = $("#sched_msg").val();
            if (schedMessage == "segmented") {
                $("#sched_date_time").show(500);
                $("#sched_date_time .send-interval").show(500);
                $("#sched_date_time .vol-interval").show(500);
            } else if(schedMessage == "yes_segment"){
                $("#sched_date_time").show(500);
                $("#sched_date_time .send-interval").hide(500);
                $("#sched_date_time .vol-interval").hide(500);
            }else{
                 $("#sched_date_time").hide(500);
                $("#sched_date_time .send-interval").hide(500);
                $("#sched_date_time .vol-interval").hide(500);
            }
        });

        $("#file_upload").on("change", function() {

            var ext = $('#file_upload').val().split('.').pop().toLowerCase();
            if ($.inArray(ext, ['csv', 'txt', 'xls', 'xlsx']) == -1) {
                alert('invalid extension!');
                $('#file_upload').val("");
            }
        });

        $("#btn_send_bulk_sms").on("click", function(e) {
            var isformValid = $('#send_bulk_sms').data('formValidation').validate();
            console.log(isformValid["$invalidFields"].length);
            if (isformValid["$invalidFields"].length <= 0) {
                let camp_name_fin = $("#campaign_name_input").val();
                let sms_to_send_fin = $("#bulk_sms_txtarea").val();
                let send_id_fin = $("#sende_id").val();
                let mess_type_fin = $("#mess_type option:selected").text().trim();
                let mess_send_as_fin = $("#mess_send_as option:selected").text().trim();
                let sche_mess = $("#sched_msg option:selected").text().trim();

                $("#conf_camp_name").html(camp_name_fin);
                $("#conf_send_id").html(send_id_fin);
                $("#conf_mess_type").html(mess_type_fin);
                $("#conf_send_as").html(mess_send_as_fin);
                $("#conf_sch_mess").html(sche_mess);
                $("#txtar_fin_conf_sms").html(sms_to_send_fin);
                $('#mod_send_conf_msg').modal('show');
            } else if (isformValid["$invalidFields"].length > 0) {
                $('#mod_send_conf_msg').modal('hide');
            }
            e.preventDefault();
        });

        $('#mod_send_conf_msg').on('hidden.bs.modal', function() {
            $('#btn_send_bulk_sms').prop('disabled', false);
            $('#btn_send_bulk_sms').removeAttr("disabled");
        });

        $("#btn_conf_yes").on("click", function() {
                let remo_dup_status = false;
                let inc_test_num_stat = false;
                if ($("#remove_dupl").is(':checked')) {
                    remo_dup_status = $("#remove_dupl").is(':checked');
                    alert(remo_dup_status);// To verify
                }
                else {
                   remo_dup_status = $("#remove_dupl").is(':checked');
                   alert(remo_dup_status);// To verify
                }
                if ($("#incl_test_num").is(':checked')) {
                    inc_test_num_stat = $("#incl_test_num").is(':checked');
                    alert(inc_test_num_stat);// To verify
                }
                else {
                   inc_test_num_stat = $("#incl_test_num").is(':checked');
                   alert(inc_test_num_stat);// To verify
                }
                var data = {};
                data["campaignName"] = $("#campaign_name_input").val();
                data["senderId"] = $("#sende_id").val();
                data["messType"] = $("#mess_type").val();
                data["messSendas"] = $("#mess_send_as").val();
                data["sendSMS"] = $("#bulk_sms_txtarea").val();
                data["schedMessage"] = $("#sched_msg").val();
                data["startDate"] = $("#datepicker-autoclose").val();
                data["schHours"] = $("#sch_hours").val();
                data["schMinutes"] = $("#sch_minutes").val();
                data["Interval"] = $("#interval").val();
                data["Interval"] = $("#interval").val();
                data["volPerinterval"] = $("#vol_per_interval").val();
                data["removeDupl"] = remo_dup_status;
                data["inclTestnum"] = inc_test_num_stat;
                
                console.log(JSON.stringify(data));
               
               /* $.ajax({
                    url: "/",
                    method: "POST",
                    data: data,
                    datatype: "json",
                    success: function(response) {
                    },
                    error: function(e) {
                    console.log("Error: ", e.responseText);
                    }
                });*/
        });

    });
</script>
<script src="plugins/bootstrap-colorpicker/js/bootstrap-colorpicker.min.js"></script>
<script src="plugins/bootstrap-datepicker/js/bootstrap-datepicker.min.js"></script>
<script src="plugins/select2/js/select2.min.js" type="text/javascript"></script>
<script src="plugins/bootstrap-maxlength/bootstrap-maxlength.min.js" type="text/javascript"></script>
<script src="plugins/bootstrap-filestyle/js/bootstrap-filestyle.min.js" type="text/javascript"></script>
<script src="plugins/bootstrap-touchspin/js/jquery.bootstrap-touchspin.min.js" type="text/javascript"></script>

<!-- Plugins Init js -->
<script src="pages/form-advanced.js"></script>
